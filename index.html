<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Vocab Master | Professional Edition</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;800;900&family=Cairo:wght@700;900&family=Assistant:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --glass: rgba(255, 255, 255, 0.95); }
        body { 
            font-family: 'Outfit', 'Assistant', sans-serif; 
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #4338ca 100%);
            background-attachment: fixed;
            min-height: 100vh;
            margin: 0;
            padding: 0;
        }
        .arabic { font-family: 'Cairo', sans-serif; direction: rtl; }
        .hebrew { font-family: 'Assistant', sans-serif; direction: rtl; }
        .rtl { direction: rtl; }
        
        .game-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(2, 1fr);
            width: 100%;
        }
        @media (min-width: 640px) {
            .game-grid { grid-template-columns: repeat(4, 1fr); }
        }
        @media (min-width: 1024px) {
            .game-grid { grid-template-columns: repeat(5, 1fr); }
        }

        .perspective-1000 { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            transform-style: preserve-3d;
            cursor: pointer;
        }
        .card-flipped { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            padding: 8px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .card-front { background: white; border: 2px solid #e2e8f0; color: #4338ca; font-size: 1.5rem; font-weight: 900; }
        .card-back { transform: rotateY(180deg); background: #ffffff; border: 2px solid #4338ca; }

        .card-text {
            display: -webkit-box;
            -webkit-line-clamp: 6;
            -webkit-box-orient: vertical;
            overflow: hidden;
            word-wrap: break-word;
            line-height: 1.2;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 3px solid #fff;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .gap-select {
            appearance: none;
            background-color: #f1f5f9;
            border-bottom: 3px solid #4338ca;
            border-radius: 4px;
            padding: 2px 8px;
            font-weight: 800;
            color: #4338ca;
            cursor: pointer;
            outline: none;
        }
    </style>
</head>
<body class="text-slate-900">
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0/client"
      }
    }
    </script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';

        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycbxCrhY80_FZB6hWbc69EjsfUQKgMUaDT8eMeiATGWkrMikV2AvgOTkIlnIL8sZRkXUfCg/exec';

        const VOCAB_DATA = {
            English: {
                A: [
                    { id: 101, word: "addition", ar: "إضافة", def: "Adding, extension or inclusion", sentence: "The new ___ to the building looks great." },
                    { id: 102, word: "advance", ar: "تقدم", def: "Progress or new discoveries", sentence: "Technology continues to ___ at a rapid pace." },
                    { id: 103, word: "advanced", ar: "متقدم", def: "Modern or very high level", sentence: "She is taking an ___ math course this year." },
                    { id: 104, word: "advertising", ar: "إعلان", def: "Business of persuading people to buy", sentence: "The company spent a lot on ___." },
                    { id: 105, word: "analysis", ar: "تحليل", def: "Examining something carefully", sentence: "The chemical ___ showed high levels of salt." },
                    { id: 106, word: "appear", ar: "يظهر", def: "To start to be seen", sentence: "The sun will ___ from behind the clouds soon." },
                    { id: 107, word: "approach", ar: "نهج", def: "Method or way of dealing with something", sentence: "We need a new ___ to solve this problem." },
                    { id: 108, word: "average", ar: "معدل", def: "Ordinary, usual or normal", sentence: "The ___ student spends two hours on homework." },
                    { id: 109, word: "available", ar: "متاح", def: "Able to be used or obtained", sentence: "Is there any water ___ for the guests?" },
                    { id: 110, word: "benefit", ar: "فائدة", def: "An advantage or positive profit", sentence: "Regular exercise is a major ___ to your health." }
                ],
                B: [
                    { id: 201, word: "consider", ar: "يفكر في", def: "Think carefully about something", sentence: "Please ___ my offer." },
                    { id: 202, word: "constant", ar: "ثابت", def: "Occurring continuously over time", sentence: "He is in ___ pain." },
                    { id: 203, word: "contain", ar: "يحتوي", def: "Have or hold within itself", sentence: "This box ___ old photos." },
                    { id: 204, word: "context", ar: "سياق", def: "Circumstances around an event", sentence: "You need to see the word in ___." },
                    { id: 205, word: "create", ar: "يخلق", def: "Bring something into existence", sentence: "Artists ___ beautiful works." },
                    { id: 206, word: "critical", ar: "حاسم", def: "Expressing adverse comments", sentence: "The situation has reached a ___ point." },
                    { id: 207, word: "culture", ar: "ثقافة", def: "Arts and customs of a people", sentence: "I love learning about Greek ___." },
                    { id: 208, word: "damage", ar: "ضرر", def: "Physical harm or destruction", sentence: "The storm caused a lot of ___." },
                    { id: 209, word: "decision", ar: "قرار", def: "A conclusion reached after thought", sentence: "It was a difficult ___ to make." },
                    { id: 210, word: "decrease", ar: "ينقص", def: "Make smaller or less in amount", sentence: "The population began to ___." }
                ],
                C: [
                    { id: 301, word: "efficient", ar: "فعال", def: "Achieving maximum productivity", sentence: "We need a more ___ way to work." },
                    { id: 302, word: "environment", ar: "بيئة", def: "Surroundings in which one lives", sentence: "We must protect the ___." },
                    { id: 303, word: "evidence", ar: "دليل", def: "Facts indicating truth", sentence: "There is no ___ to support him." },
                    { id: 304, word: "feature", ar: "ميزة", def: "A distinctive attribute", sentence: "This phone has a unique ___." },
                    { id: 305, word: "global", ar: "عالمي", def: "Relating to the whole world", sentence: "Pollution is a ___ problem." },
                    { id: 306, word: "identify", ar: "يحدد", def: "Establish who or what something is", sentence: "Can you ___ the suspect?" },
                    { id: 307, word: "impact", ar: "تأثير", def: "Effect or influence", sentence: "The news had a big ___ on us." },
                    { id: 308, word: "indicate", ar: "يشير", def: "Point out or show", sentence: "Studies ___ a link between them." },
                    { id: 309, word: "issue", ar: "قضية", def: "Important topic or problem", sentence: "Climate change is a major ___." },
                    { id: 310, word: "major", ar: "رئيسي", def: "Important or serious", sentence: "He underwent a ___ operation." }
                ],
                D: [
                    { id: 401, word: "method", ar: "طريقة", def: "Particular way of doing something", sentence: "Which ___ did you use?" },
                    { id: 402, word: "negative", ar: "سلبي", def: "Expressing denial or bad news", sentence: "Try to avoid ___ thoughts." },
                    { id: 403, word: "obtain", ar: "يحصل على", def: "Get or acquire something", sentence: "Where can I ___ a permit?" },
                    { id: 404, word: "outcome", ar: "نتيجة", def: "Way a thing turns out", sentence: "We are waiting for the ___." },
                    { id: 405, word: "period", ar: "فترة", def: "Length of time", sentence: "It was a difficult ___ for her." },
                    { id: 406, word: "policy", ar: "سياسة", def: "Course of action adopted", sentence: "What is the company's ___?" },
                    { id: 407, word: "range", ar: "نطاق", def: "Area of variation", sentence: "The price ___ is quite wide." },
                    { id: 408, word: "require", ar: "يتطلب", def: "Need for a particular purpose", sentence: "Does this ___ a signature?" },
                    { id: 409, word: "source", ar: "مصدر", def: "Place where something starts", sentence: "What is the ___ of this information?" },
                    { id: 410, word: "theory", ar: "نظرية", def: "Supposition or system of ideas", sentence: "In ___ it should work fine." }
                ]
            },
            Hebrew: {
                "א": [
                    { id: 501, word: "מתנפלים", ar: "ينقضون", def: "התקפה פתאומית על מישהו", sentence: "הזאבים ___ על הטרף." },
                    { id: 502, word: "צוף פרחים", ar: "رحيق الأزهار", def: "נוזל מתוק שדבורים אוספות", sentence: "הדבורים אוספות ___." },
                    { id: 503, word: "יערות", ar: "غابات", def: "שטחים גדולים מלאים בעצים", sentence: "יש הרבה חיות בתוך ___." },
                    { id: 504, word: "מקומות בילוי", ar: "أماكن ترفيه", def: "מקומות שאנשים הולכים להנות", sentence: "העיר מלאה ב___." },
                    { id: 505, word: "לפענח", ar: "فك الرموز", def: "למצוא פתרון לקוד או סוד", sentence: "ניסינו ___ את סוד המפה." },
                    { id: 506, word: "משימה", ar: "משימה", def: "עבודה שצריך לבצע", sentence: "היתה לנו ___ קשה לסיים." },
                    { id: 507, word: "אתגר", ar: "تحدي", def: "משהו שקשה לעשות", sentence: "הטיפוס היה ___ אמיתי." },
                    { id: 508, word: "תחביב", ar: "هواية", def: "משהו שעושים בשעות הפנאי", sentence: "הציור הוא ה___ הכי אהוב עליי." },
                    { id: 509, word: "הפתעה", ar: "مفاجأة", def: "משהו שלא ציפינו לו", sentence: "הכינו לו ___ גדולה ליום ההולדת." },
                    { id: 510, word: "ניצחון", ar: "نصر", def: "הצלחה בתחרות או קרב", sentence: "הקבוצה חגגה את ה___ שלה." }
                ],
                "ב": [
                    { id: 601, word: "הישרדות", ar: "بقاء", def: "היכולת להמשיך לחיות בקושי", sentence: "החיות נלחמות על ה___ שלהן." },
                    { id: 602, word: "נדידה", ar: "هجرة", def: "מעבר של חיות ממקום למקום", sentence: "עכשיו זו עונת ה___ של הציפורים." },
                    { id: 603, word: "טורף", ar: "مفترס", def: "חיה שאוכלת חיות אחרות", sentence: "האריה הוא ___ חזק." },
                    { id: 604, word: "תרומה", ar: "تبرع", def: "נתינה של כסף או עזרה", sentence: "הוא נתן ___ נדיבה." },
                    { id: 605, word: "חיוני", ar: "ضروري", def: "דבר שאי אפשר בלעדיו", sentence: "מים הם דבר ___ לחיים." },
                    { id: 606, word: "סביבה", ar: "بيئة", def: "העולם שסביבנו", sentence: "חשוב לשמור על ה___ נקייה." },
                    { id: 607, word: "מחקר", ar: "بحث", def: "לימוד מעמיק של נושא", sentence: "המדענים פרסמו ___ חדש." },
                    { id: 608, word: "גילוי", ar: "اكتشاف", def: "מציאת משהו חדש", sentence: "זה היה ___ מרגש במיוחד." },
                    { id: 609, word: "מכשיר", ar: "جهاز", def: "כלי שעוזר לעשות עבודה", sentence: "יש לי ___ חדש במטבח." },
                    { id: 610, word: "טכנולוגיה", ar: "تكنولوجيا", def: "מדע יישומי מתקדם", sentence: "ה___ משנה את העולם." }
                ]
            }
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('login'); 
            const [lang, setLang] = useState('English');
            const [gameConfig, setGameConfig] = useState({ difficulty: 'Medium', list: 'A', mode: 'Word-Arabic' });
            const [cards, setCards] = useState([]);
            const [flipped, setFlipped] = useState([]);
            const [matched, setMatched] = useState([]);
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            const [isGameOver, setIsGameOver] = useState(false);
            const [syncing, setSyncing] = useState(false);
            const [testResult, setTestResult] = useState(null);
            const [testQuestions, setTestQuestions] = useState([]);
            const [testAnswers, setTestAnswers] = useState({});
            
            const timerRef = useRef(null);
            const userRef = useRef(null);
            const hasSynced = useRef(false);
            const langRef = useRef('English');

            useEffect(() => { langRef.current = lang; }, [lang]);

            const isHeb = lang === 'Hebrew';

            const UI = {
                title: isHeb ? "מאסטר אוצר מילים" : "VOCAB MASTER",
                subtitle: "Fouad Nasir",
                namePlaceholder: isHeb ? "שם התלמיד" : "Student Name",
                classPlaceholder: isHeb ? "כיתה" : "Class",
                enterBtn: isHeb ? "כניסה" : "ENTER",
                welcome: isHeb ? "שלום, " : "Hello, ",
                changeLang: isHeb ? "שפה" : "Lang",
                vocabList: isHeb ? "רשימה" : "List",
                speed: isHeb ? "רמת קושי" : "Difficulty",
                mode: isHeb ? "מצב משחק" : "Mode",
                practiceTitle: isHeb ? "אימון זיכרון" : "Memory Practice",
                practiceDesc: isHeb ? "התאמת זוגות מילים לשיפור אוצר המילים." : "Match pairs of words to master vocabulary.",
                testTitle: isHeb ? "מבחן הערכה" : "Take a Test",
                testDesc: isHeb ? "מבחן לבדיקת הידע שלך ברשימה שנבחרה." : "Assessment quiz to verify your knowledge.",
                quit: isHeb ? "יציאה" : "Quit",
                scoreLabel: isHeb ? "ניקוד: " : "Score: ",
                submit: isHeb ? "הגשה" : "SUBMIT",
                tryAgain: isHeb ? "נסה שוב" : "Retry",
                mainMenu: isHeb ? "תפריט ראשי" : "Menu",
                finalScoreLabel: isHeb ? "ציון סופי" : "Score",
                question: isHeb ? "שאלה" : "Q",
                difficultyOptions: isHeb ? ["קל", "בינוני", "קשה"] : ["Easy", "Medium", "Hard"],
                modeOptions: isHeb ? 
                    [{ v: "Word-Arabic", l: "מילה-ערבית" }, { v: "Word-Definition", l: "מילה-הגדרה" }] : 
                    [{ v: "Word-Arabic", l: "Word-Arabic" }, { v: "Word-Definition", l: "Word-Definition" }],
                complete: isHeb ? "הושלם!" : "COMPLETE!",
                review: isHeb ? "סקירת תשובות" : "Review Answers",
                correct: isHeb ? "נכון" : "Correct",
                yourAnswer: isHeb ? "התשובה שלך" : "Your Answer",
                missed: isHeb ? "טעויות לשיפור" : "Mistakes to Review"
            };

            const getEncouragement = (score) => {
                if (isHeb) {
                    if (score === 100) return "מצוין! כל הכבוד על ההישג המושלם!";
                    if (score >= 80) return "עבודה נהדרת! אתה בדרך הנכונה!";
                    if (score >= 60) return "טוב מאוד, המשך להתאמן ותשתפר!";
                    return "אל תתייאש, תרגול נוסף יביא אותך להצלחה!";
                } else {
                    if (score === 100) return "Outstanding! Perfect score!";
                    if (score >= 80) return "Great job! You are mastering this list!";
                    if (score >= 60) return "Well done! Keep practicing to reach the top!";
                    return "Don't give up! Practice makes perfect.";
                }
            };

            const triggerSync = async (modeName, finalScore, timeSpent) => {
                if (hasSynced.current) return;
                hasSynced.current = true;
                setSyncing(true);
                
                const scoreValue = (finalScore !== undefined && finalScore !== null) ? finalScore.toString() : "0";

                const payload = [
                    new Date().toLocaleString('en-GB'),
                    userRef.current?.name || "Unknown",
                    userRef.current?.className || "Unknown",
                    langRef.current,
                    modeName,
                    gameConfig.list,
                    gameConfig.difficulty,
                    scoreValue,
                    timeSpent
                ];
                
                try {
                    await fetch(GOOGLE_SHEET_URL, { 
                        method: 'POST', 
                        mode: 'no-cors', 
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload) 
                    });
                } catch (e) { console.error("Sync Error:", e); }
                setSyncing(false);
            };

            const handleLogin = () => {
                const name = document.getElementById('nameIn')?.value;
                const cls = document.getElementById('classIn')?.value;
                if (!name || !cls) return;
                userRef.current = { name, className: cls };
                setUser(userRef.current);
                setView('menu');
            };

            const startGame = () => {
                hasSynced.current = false;
                const list = VOCAB_DATA[lang][gameConfig.list];
                setTimeLeft(240); 
                setScore(0); setMatched([]); setFlipped([]); setIsGameOver(false); setView('game');
                
                const subset = [...list].sort(() => 0.5 - Math.random()).slice(0, 10);
                const newCards = [];
                subset.forEach(item => {
                    newCards.push({ id: item.id, text: item.word, type: 'native' });
                    const matchText = gameConfig.mode === 'Word-Arabic' ? item.ar : item.def;
                    newCards.push({ id: item.id, text: matchText, type: 'match' });
                });
                setCards(newCards.sort(() => 0.5 - Math.random()));
            };

            const startTest = () => {
                hasSynced.current = false;
                setTestResult(null); setTestAnswers({}); setTimeLeft(300);
                const fullList = VOCAB_DATA[lang][gameConfig.list];
                const shuffled = [...fullList].sort(() => 0.5 - Math.random()).slice(0, 10);
                
                const questions = shuffled.map((item, index) => ({
                    id: item.id,
                    type: index < 5 ? 'multiple' : 'dropdown',
                    correct: item.word,
                    sentence: item.sentence,
                    options: [item.word, ...fullList.filter(x => x.id !== item.id).sort(() => 0.5 - Math.random()).slice(0, 3).map(x => x.word)].sort(() => 0.5 - Math.random())
                }));
                setTestQuestions(questions);
                setView('test');
            };

            const submitTest = () => {
                if (hasSynced.current) return;
                let correctCount = 0;
                testQuestions.forEach(q => { if (testAnswers[q.id] === q.correct) correctCount++; });
                const finalP = Math.round((correctCount / testQuestions.length) * 100);
                setTestResult(finalP);
                const timeStr = `${Math.floor((300 - timeLeft)/60)}:${((300 - timeLeft)%60).toString().padStart(2, '0')}`;
                triggerSync(isHeb ? "מבחן הערכה" : "Take a Test", finalP, timeStr);
            };

            useEffect(() => {
                if (user && (view === 'game' || (view === 'test' && testResult === null)) && timeLeft > 0) {
                    timerRef.current = setInterval(() => setTimeLeft(t => t - 1), 1000);
                }
                if (timeLeft === 0 && user && !hasSynced.current) {
                    if (view === 'game') {
                        setIsGameOver(true);
                        setScore(currentScore => {
                            triggerSync(isHeb ? "אימון זיכרון" : "Memory Practice", currentScore, "Time Up");
                            return currentScore;
                        });
                    } else if (view === 'test' && testResult === null) {
                        submitTest();
                    }
                }
                return () => clearInterval(timerRef.current);
            }, [user, view, timeLeft, testResult]);

            const getFontSize = (text, type) => {
                if (type === 'native') return 'text-sm sm:text-xl font-black';
                if (text.length > 50) return 'text-[0.6rem] sm:text-xs font-bold';
                if (text.length > 30) return 'text-xs sm:text-sm font-bold';
                return 'text-xs sm:text-base font-black';
            };

            if (view === 'login') return (
                <div className="min-h-screen flex items-center justify-center p-4">
                    <div className="bg-white rounded-[2rem] p-6 w-full max-w-sm shadow-2xl text-center border-t-8 border-indigo-600">
                        <h1 className={`text-3xl font-black text-indigo-900 mb-1 ${isHeb ? 'hebrew' : ''}`}>{UI.title}</h1>
                        <p className="text-indigo-600 font-bold mb-6 italic">{UI.subtitle}</p>
                        <div className="space-y-4">
                            <input id="nameIn" placeholder={UI.namePlaceholder} className={`w-full p-4 bg-slate-100 rounded-xl font-bold border-2 border-transparent focus:border-indigo-500 outline-none text-lg ${isHeb ? 'hebrew text-right' : ''}`} />
                            <input id="classIn" placeholder={UI.classPlaceholder} className={`w-full p-4 bg-slate-100 rounded-xl font-bold border-2 border-transparent focus:border-indigo-500 outline-none text-lg ${isHeb ? 'hebrew text-right' : ''}`} />
                            <div className="flex gap-2">
                                <button onClick={() => { setLang('English'); setGameConfig({...gameConfig, list: 'A'}); }} className={`flex-1 py-3 rounded-xl font-black transition-all ${lang === 'English' ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-200 text-slate-500'}`}>ENG</button>
                                <button onClick={() => { setLang('Hebrew'); setGameConfig({...gameConfig, list: 'א'}); }} className={`flex-1 py-3 rounded-xl font-black transition-all ${lang === 'Hebrew' ? 'bg-indigo-600 text-white shadow-md' : 'bg-slate-200 text-slate-500'} hebrew`}>עברית</button>
                            </div>
                            <button onClick={handleLogin} className={`w-full py-4 bg-indigo-600 text-white rounded-xl font-black text-xl shadow-lg hover:bg-indigo-700 transition-all ${isHeb ? 'hebrew' : ''}`}>{UI.enterBtn}</button>
                        </div>
                    </div>
                </div>
            );

            if (view === 'menu') return (
                <div className={`max-w-xl mx-auto space-y-4 py-8 px-4 ${isHeb ? 'rtl' : ''}`}>
                    <div className="bg-white rounded-[2rem] p-6 shadow-xl">
                        <div className="flex justify-between items-center mb-6">
                            <div className={`${isHeb ? 'text-right' : 'text-left'}`}>
                                <h2 className={`text-2xl font-black text-indigo-950 ${isHeb ? 'hebrew' : ''}`}>{UI.welcome}{user.name}</h2>
                                <span className="text-indigo-500 font-bold text-xs uppercase tracking-widest">{lang}</span>
                            </div>
                            <button onClick={() => setView('login')} className="text-[10px] bg-slate-100 px-3 py-2 rounded-lg text-indigo-600 font-black uppercase">{UI.changeLang}</button>
                        </div>
                        <div className="grid grid-cols-2 gap-4 mb-4">
                            <div className="space-y-1">
                                <label className={`text-[10px] font-black text-indigo-500 uppercase block ${isHeb ? 'hebrew text-right' : ''}`}>{UI.vocabList}</label>
                                <select className="w-full p-3 bg-slate-50 rounded-xl font-black text-sm outline-none border border-slate-200" value={gameConfig.list} onChange={e => setGameConfig({...gameConfig, list: e.target.value})}>
                                    {Object.keys(VOCAB_DATA[lang]).map(l => <option key={l} value={l}>{l}</option>)}
                                </select>
                            </div>
                            <div className="space-y-1">
                                <label className={`text-[10px] font-black text-indigo-500 uppercase block ${isHeb ? 'hebrew text-right' : ''}`}>{UI.speed}</label>
                                <select className="w-full p-3 bg-slate-50 rounded-xl font-black text-sm outline-none border border-slate-200" value={gameConfig.difficulty} onChange={e => setGameConfig({...gameConfig, difficulty: e.target.value})}>
                                    {UI.difficultyOptions.map((opt, i) => (
                                        <option key={i} value={["Easy", "Medium", "Hard"][i]}>{opt}</option>
                                    ))}
                                </select>
                            </div>
                        </div>
                        <div className="space-y-1">
                            <label className={`text-[10px] font-black text-indigo-500 uppercase block ${isHeb ? 'hebrew text-right' : ''}`}>{UI.mode}</label>
                            <select className="w-full p-3 bg-slate-50 rounded-xl font-black text-sm outline-none border border-slate-200" value={gameConfig.mode} onChange={e => setGameConfig({...gameConfig, mode: e.target.value})}>
                                {UI.modeOptions.map(m => <option key={m.v} value={m.v}>{m.l}</option>)}
                            </select>
                        </div>
                    </div>
                    <div className="space-y-3">
                        <button onClick={startGame} className={`w-full p-6 bg-indigo-600 text-white rounded-[1.5rem] shadow-lg hover:brightness-110 transition-all ${isHeb ? 'text-right' : 'text-left'}`}>
                            <h3 className={`text-2xl font-black ${isHeb ? 'hebrew' : ''}`}>{UI.practiceTitle}</h3>
                            <p className={`text-indigo-200 text-xs opacity-80 ${isHeb ? 'hebrew' : ''}`}>{UI.practiceDesc}</p>
                        </button>
                        <button onClick={startTest} className={`w-full p-6 bg-white text-indigo-900 rounded-[1.5rem] shadow-lg border-2 border-indigo-600 hover:bg-indigo-50 transition-all ${isHeb ? 'text-right' : 'text-left'}`}>
                            <h3 className={`text-2xl font-black ${isHeb ? 'hebrew' : ''}`}>{UI.testTitle}</h3>
                            <p className={`text-slate-400 text-xs ${isHeb ? 'hebrew' : ''}`}>{UI.testDesc}</p>
                        </button>
                    </div>
                </div>
            );

            if (view === 'game') return (
                <div className={`p-4 flex flex-col min-h-screen ${isHeb ? 'rtl' : ''}`}>
                    <div className="flex justify-between items-center mb-6 bg-white/10 p-4 rounded-2xl backdrop-blur-md border border-white/20">
                        <span className="text-white font-black text-xl tabular-nums">{Math.floor(timeLeft/60)}:{(timeLeft%60).toString().padStart(2, '0')}</span>
                        <button onClick={() => setView('menu')} className={`text-white font-bold text-xs uppercase bg-black/20 px-4 py-2 rounded-full ${isHeb ? 'hebrew' : ''}`}>{UI.quit}</button>
                        <span className={`text-white font-black text-xl ${isHeb ? 'hebrew' : ''}`}>{UI.scoreLabel}{score}</span>
                    </div>
                    
                    <div className="game-grid">
                        {cards.map((card, i) => {
                            const isMatched = matched.includes(card.id);
                            const isFlipped = flipped.includes(i) || isMatched;
                            const isHebrewCard = isHeb && card.type === 'native';
                            const isArabicCard = gameConfig.mode === 'Word-Arabic' && card.type === 'match';
                            
                            return (
                                <div key={i} onClick={() => {
                                    if (isGameOver || flipped.length === 2 || flipped.includes(i) || isMatched) return;
                                    const next = [...flipped, i]; setFlipped(next);
                                    if (next.length === 2) {
                                        const c1 = cards[next[0]], c2 = cards[next[1]];
                                        if (c1.id === c2.id && c1.type !== c2.type) {
                                            const newMatched = [...matched, c1.id];
                                            const newScore = Math.min(100, Math.round((newMatched.length / (cards.length / 2)) * 100));
                                            setMatched(newMatched); 
                                            setScore(newScore); 
                                            setFlipped([]);
                                            if (newMatched.length === (cards.length / 2)) {
                                                setIsGameOver(true);
                                                triggerSync(isHeb ? "אימון זיכרון" : "Memory Practice", newScore, `${Math.floor((240-timeLeft)/60)}:${((240-timeLeft)%60).toString().padStart(2, '0')}`);
                                            }
                                        } else { setTimeout(() => setFlipped([]), 800); }
                                    }
                                }} className="aspect-square perspective-1000">
                                    <div className={`card-inner ${isFlipped ? 'card-flipped' : ''}`}>
                                        <div className="card-front">?</div>
                                        <div className={`card-back ${isMatched ? 'bg-emerald-500 border-emerald-400 text-white' : 'text-indigo-900'}`}>
                                            <div className={`card-text ${getFontSize(card.text, card.type)} ${isArabicCard ? 'arabic' : isHebrewCard ? 'hebrew' : ''}`}>
                                                {card.text}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {isGameOver && (
                        <div className="fixed inset-0 bg-indigo-950/90 flex items-center justify-center p-6 z-50">
                            <div className="bg-white rounded-[2rem] p-8 text-center w-full max-w-sm shadow-2xl">
                                <h2 className={`text-3xl font-black text-indigo-900 mb-2 ${isHeb ? 'hebrew' : ''}`}>{UI.complete}</h2>
                                <div className="text-6xl font-black text-indigo-600 mb-2 tabular-nums">{score}</div>
                                <p className={`text-slate-500 font-bold mb-6 italic ${isHeb ? 'hebrew' : ''}`}>{getEncouragement(score)}</p>
                                <button onClick={startGame} className={`w-full py-4 bg-indigo-600 text-white rounded-xl font-bold mb-3 text-lg ${isHeb ? 'hebrew' : ''}`}>{UI.tryAgain}</button>
                                <button onClick={() => setView('menu')} className={`text-slate-400 font-bold uppercase text-xs ${isHeb ? 'hebrew' : ''}`}>{UI.mainMenu}</button>
                            </div>
                        </div>
                    )}
                </div>
            );

            if (view === 'test') return (
                <div className={`p-4 ${isHeb ? 'rtl' : ''}`}>
                    <div className="bg-white rounded-[2rem] shadow-xl p-6 sm:p-10 mb-10 max-w-2xl mx-auto">
                        <header className="flex justify-between items-center mb-8 border-b-2 border-slate-100 pb-4">
                            <h2 className={`text-xl font-black text-indigo-950 uppercase ${isHeb ? 'hebrew' : ''}`}>{UI.testTitle} {gameConfig.list}</h2>
                            {testResult === null && <span className="text-2xl font-black text-indigo-600 tabular-nums">{Math.floor(timeLeft/60)}:{(timeLeft%60).toString().padStart(2, '0')}</span>}
                        </header>

                        {testResult === null ? (
                            <div className="space-y-12">
                                {testQuestions.map((q, idx) => (
                                    <div key={q.id} className="space-y-4">
                                        <div className="flex items-center gap-3 text-indigo-500 font-black text-[10px] uppercase">
                                            <span className={isHeb ? 'hebrew' : ''}>{UI.question} {idx + 1}</span>
                                            <div className="h-[2px] flex-1 bg-slate-100"></div>
                                        </div>
                                        {q.type === 'multiple' ? (
                                            <div className="space-y-4">
                                                <p className={`text-lg font-bold text-slate-800 ${isHeb ? 'hebrew text-right' : ''}`}>
                                                    {q.sentence.replace('___', '__________')}
                                                </p>
                                                <div className="grid grid-cols-1 gap-2">
                                                    {q.options.map(opt => (
                                                        <button key={opt} onClick={() => setTestAnswers({...testAnswers, [q.id]: opt})} className={`p-4 rounded-xl text-left font-black border-2 transition-all ${isHeb ? 'hebrew text-right' : ''} ${testAnswers[q.id] === opt ? 'bg-indigo-600 border-indigo-600 text-white' : 'bg-slate-50 border-transparent text-slate-600'}`}>{opt}</button>
                                                    ))}
                                                </div>
                                            </div>
                                        ) : (
                                            <div className="space-y-4">
                                                <p className={`text-lg font-bold text-slate-800 leading-relaxed ${isHeb ? 'hebrew text-right' : ''}`}>
                                                    {isHeb ? q.sentence.split('___')[1] : q.sentence.split('___')[0]}
                                                    <select className="gap-select mx-2" value={testAnswers[q.id] || ""} onChange={(e) => setTestAnswers({...testAnswers, [q.id]: e.target.value})}>
                                                        <option value="" disabled>---</option>
                                                        {q.options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                                                    </select>
                                                    {isHeb ? q.sentence.split('___')[0] : q.sentence.split('___')[1]}
                                                </p>
                                            </div>
                                        )}
                                    </div>
                                ))}
                                <button onClick={submitTest} disabled={syncing} className={`w-full py-5 bg-indigo-600 text-white rounded-2xl font-black text-xl shadow-lg flex items-center justify-center gap-4 ${isHeb ? 'hebrew' : ''}`}>
                                    {syncing && <div className="spinner"></div>} {UI.submit}
                                </button>
                            </div>
                        ) : (
                            <div className="text-center py-6">
                                <div className={`text-sm font-black text-indigo-400 uppercase tracking-widest mb-2 ${isHeb ? 'hebrew' : ''}`}>{UI.finalScoreLabel}</div>
                                <div className="text-9xl font-black text-indigo-900 leading-none mb-4 tabular-nums">{testResult}</div>
                                <p className={`text-indigo-600 font-bold mb-10 text-lg ${isHeb ? 'hebrew' : ''}`}>{getEncouragement(testResult)}</p>
                                
                                {testResult < 100 && (
                                    <div className="mb-10 text-left">
                                        <h3 className={`text-lg font-black text-rose-600 mb-4 border-b pb-2 ${isHeb ? 'hebrew text-right' : ''}`}>{UI.missed}</h3>
                                        <div className="space-y-4">
                                            {testQuestions.filter(q => testAnswers[q.id] !== q.correct).map(q => {
                                                const vocabItem = VOCAB_DATA[lang][gameConfig.list].find(v => v.id === q.id);
                                                return (
                                                    <div key={q.id} className={`p-4 bg-slate-50 rounded-xl border-r-4 ${isHeb ? 'border-rose-400 text-right' : 'border-rose-400 text-left'}`}>
                                                        <div className={`font-black text-indigo-950 ${isHeb ? 'hebrew' : ''}`}>
                                                            {q.sentence.replace('___', `[${q.correct}]`)}
                                                        </div>
                                                        <div className="mt-2 flex flex-col gap-1 text-sm">
                                                            <div className="text-emerald-600 font-bold">
                                                                {UI.correct}: <span className={isHeb ? 'hebrew' : ''}>{q.correct}</span>
                                                                <span className="text-slate-400 mx-2">|</span>
                                                                <span className="arabic">{vocabItem.ar}</span>
                                                            </div>
                                                            <div className="text-rose-500 font-bold">
                                                                {UI.yourAnswer}: <span className={isHeb ? 'hebrew' : ''}>{testAnswers[q.id] || "---"}</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                )}

                                <button onClick={() => setView('menu')} className={`w-full py-5 bg-slate-900 text-white rounded-2xl font-black text-xl uppercase shadow-xl ${isHeb ? 'hebrew' : ''}`}>{UI.mainMenu}</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
