<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Band III Vocab Master</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .arabic { font-family: 'Cairo', sans-serif; }
        .perspective-1000 { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.5s;
            transform-style: preserve-3d;
        }
        .flipped { transform: rotateY(180deg); }
        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 1rem;
            padding: 0.75rem;
            text-align: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .card-back { transform: rotateY(180deg); }
        .spinner {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 2px solid #fff;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
    <div id="root"></div>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0/client",
        "@google/genai": "https://esm.sh/@google/genai@1.41.0"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import ReactDOM from 'react-dom';

        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycby7FIHOhY5F-1Be-TKeDZpVpIXoAitIpXoMBXCncRgKXG_by0-ADK8yxifRol_sAnpE4g/exec';

        const VOCAB_LISTS = {
            A: [
                { id: 1, en: "Analyze", ar: "يحلل", def: "Examine in detail" },
                { id: 2, en: "Approach", ar: "نهج", def: "A way of dealing with something" },
                { id: 3, en: "Assume", ar: "يفترض", def: "Suppose without proof" },
                { id: 4, en: "Benefit", ar: "فائدة", def: "An advantage gained" },
                { id: 5, en: "Concept", ar: "مفهوم", def: "An abstract idea" },
                { id: 6, en: "Context", ar: "سياق", def: "Circumstances of an event" },
                { id: 7, en: "Data", ar: "بيانات", def: "Facts and statistics" },
                { id: 8, en: "Establish", ar: "يؤسس", def: "Set up on a firm basis" },
                { id: 9, en: "Factor", ar: "عامل", def: "A circumstance that contributes" },
                { id: 10, en: "Identify", ar: "يحدد", def: "Establish who or what" }
            ],
            B: [
                { id: 11, en: "Interpret", ar: "يفسر", def: "Explain the meaning" },
                { id: 12, en: "Method", ar: "طريقة", def: "A procedure to follow" },
                { id: 13, en: "Period", ar: "فترة", def: "A length of time" },
                { id: 14, en: "Policy", ar: "سياسة", def: "Course of action adopted" },
                { id: 15, en: "Process", ar: "عملية", def: "Series of actions" },
                { id: 16, en: "Role", ar: "دور", def: "Function assumed by a person" },
                { id: 17, en: "Section", ar: "قسم", def: "Distinct group or part" },
                { id: 18, en: "Source", ar: "مصدر", def: "Place something comes from" },
                { id: 19, en: "Theory", ar: "نظرية", def: "System of ideas" },
                { id: 20, en: "Vary", ar: "يتنوع", def: "Differ in size or amount" }
            ],
            C: [
                { id: 21, en: "Acquire", ar: "يكتسب", def: "Buy or obtain for oneself" },
                { id: 22, en: "Category", ar: "فئة", def: "A class or division of people/things" },
                { id: 23, en: "Complex", ar: "معقد", def: "Consisting of many different parts" },
                { id: 24, en: "Culture", ar: "ثقافة", def: "Ideas and customs of a society" },
                { id: 25, en: "Design", ar: "يصمم", def: "A plan or drawing of something" },
                { id: 26, en: "Element", ar: "عنصر", def: "A part or aspect of something" },
                { id: 27, en: "Focus", ar: "تركيز", def: "The center of interest or activity" },
                { id: 28, en: "Impact", ar: "تأثير", def: "The action of one object hitting another" },
                { id: 29, en: "Maintain", ar: "يحافظ", def: "Keep something at the same level" },
                { id: 30, en: "Potential", ar: "إمكانية", def: "Having the capacity to develop" }
            ],
            D: [
                { id: 31, en: "Relevant", ar: "ذو صلة", def: "Closely connected to the matter" },
                { id: 32, en: "Select", ar: "يختار", def: "Carefully choose as being the best" },
                { id: 33, en: "Transfer", ar: "ينقل", def: "Move from one place to another" },
                { id: 34, en: "Utility", ar: "منفعة", def: "The state of being useful or profitable" },
                { id: 35, en: "Volume", ar: "حجم", def: "The amount of space occupied" },
                { id: 36, en: "Primary", ar: "أساسي", def: "Of chief importance; principal" },
                { id: 37, en: "Reaction", ar: "رد فعل", def: "An action performed in response" },
                { id: 38, en: "Strategy", ar: "استراتيجية", def: "A plan of action to achieve a goal" },
                { id: 39, en: "Task", ar: "مهمة", def: "A piece of work to be done" },
                { id: 40, en: "View", ar: "رؤية", def: "The ability to see something" }
            ]
        };

        const App = () => {
            const [user, setUser] = useState(null);
            const [gameConfig, setGameConfig] = useState({ difficulty: 'Medium', list: 'A', mode: 'English-Arabic' });
            
            const userRef = useRef(null);
            const configRef = useRef(null);
            
            const [cards, setCards] = useState([]);
            const [flipped, setFlipped] = useState([]);
            const [matched, setMatched] = useState([]);
            const [score, setScore] = useState(0);
            const [timeLeft, setTimeLeft] = useState(0);
            const [totalTimeLimit, setTotalTimeLimit] = useState(0);
            const [isGameOver, setIsGameOver] = useState(false);
            const [syncing, setSyncing] = useState(false);
            const timerRef = useRef(null);

            const formatTimeLabel = (totalSeconds) => {
                const m = Math.floor(totalSeconds / 60);
                const s = totalSeconds % 60;
                return `${m}:${s.toString().padStart(2, '0')}`;
            };

            const sendToSheets = async (finalScore, secondsSpent) => {
                const u = userRef.current;
                const c = configRef.current;
                if (!u) return;

                setSyncing(true);
                const payload = {
                    "Timestamp": new Date().toLocaleString(),
                    "Student Name": u.name,
                    "Class": u.className,
                    "Score": finalScore,
                    "Time": formatTimeLabel(secondsSpent),
                    "List": c.list,
                    "Difficulty": c.difficulty,
                    "Mode": c.mode
                };

                try {
                    await fetch(GOOGLE_SHEET_URL, {
                        method: 'POST',
                        mode: 'no-cors',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                } catch (e) {
                    console.error("Sheet sync failed", e);
                } finally {
                    setSyncing(false);
                }
            };

            const handleLogin = (e) => {
                e.preventDefault();
                const name = e.target.studentName.value;
                const className = e.target.className.value;
                const newUser = { name, className };
                userRef.current = newUser;
                configRef.current = gameConfig;
                setUser(newUser);
                startGame();
            };

            const startGame = () => {
                const list = VOCAB_LISTS[gameConfig.list] || VOCAB_LISTS.A;
                const duration = gameConfig.difficulty === 'Easy' ? 180 : gameConfig.difficulty === 'Medium' ? 120 : 60;
                
                setTotalTimeLimit(duration);
                setTimeLeft(duration);
                setIsGameOver(false);
                setScore(0);
                setMatched([]);
                setFlipped([]);

                const subset = [...list].sort(() => Math.random() - 0.5).slice(0, 10);
                const newCards = [];
                subset.forEach(item => {
                    newCards.push({ id: item.id, text: item.en, type: 'en', uid: `e-${item.id}` });
                    const matchText = gameConfig.mode === 'English-Arabic' ? item.ar : item.def;
                    newCards.push({ id: item.id, text: matchText, type: 'match', uid: `m-${item.id}`, isAr: gameConfig.mode === 'English-Arabic' });
                });
                setCards(newCards.sort(() => Math.random() - 0.5));
            };

            useEffect(() => {
                if (user && !isGameOver && timeLeft > 0) {
                    timerRef.current = setInterval(() => {
                        setTimeLeft(t => {
                            if (t <= 1) {
                                clearInterval(timerRef.current);
                                setIsGameOver(true);
                                sendToSheets(score, totalTimeLimit);
                                return 0;
                            }
                            return t - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(timerRef.current);
            }, [user, isGameOver]);

            const handleCardClick = (idx) => {
                if (isGameOver || flipped.length === 2 || flipped.includes(idx) || matched.includes(cards[idx].id)) return;
                
                const nextFlipped = [...flipped, idx];
                setFlipped(nextFlipped);

                if (nextFlipped.length === 2) {
                    const c1 = cards[nextFlipped[0]];
                    const c2 = cards[nextFlipped[1]];

                    if (c1.id === c2.id && c1.type !== c2.type) {
                        const newMatched = [...matched, c1.id];
                        const newScore = score + 10;
                        setMatched(newMatched);
                        setScore(newScore);
                        setFlipped([]);

                        if (newMatched.length === 10) {
                            clearInterval(timerRef.current);
                            setIsGameOver(true);
                            sendToSheets(newScore, totalTimeLimit - timeLeft);
                        }
                    } else {
                        setTimeout(() => setFlipped([]), 1000);
                    }
                }
            };

            if (!user) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-indigo-900 p-6">
                        <div className="bg-white rounded-3xl p-8 w-full max-w-sm shadow-2xl">
                            <h1 className="text-2xl font-black text-center mb-6 italic uppercase tracking-tight text-slate-800">Vocab Master</h1>
                            <form onSubmit={handleLogin} className="space-y-4">
                                <input name="studentName" required placeholder="Full Name" className="w-full p-4 bg-slate-50 border rounded-xl font-bold" />
                                <input name="className" required placeholder="Class Name (e.g. 10B)" className="w-full p-4 bg-slate-50 border rounded-xl font-bold" />
                                <div className="grid grid-cols-2 gap-2">
                                    <select className="p-3 bg-slate-100 rounded-xl font-bold" onChange={e => setGameConfig({...gameConfig, list: e.target.value})}>
                                        <option value="A">List A</option>
                                        <option value="B">List B</option>
                                        <option value="C">List C</option>
                                        <option value="D">List D</option>
                                    </select>
                                    <select className="p-3 bg-slate-100 rounded-xl font-bold" onChange={e => setGameConfig({...gameConfig, difficulty: e.target.value})} defaultValue="Medium">
                                        <option>Easy</option><option>Medium</option><option>Hard</option>
                                    </select>
                                </div>
                                <select className="w-full p-3 bg-slate-100 rounded-xl font-bold" onChange={e => setGameConfig({...gameConfig, mode: e.target.value})}>
                                    <option>English-Arabic</option><option>Word-Definition</option>
                                </select>
                                <button className="w-full py-4 bg-indigo-600 text-white rounded-xl font-black text-lg active:scale-95 transition-transform mt-4">START GAME</button>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div className="flex flex-col min-h-screen">
                    <div className="h-1.5 w-full bg-slate-200">
                        <div className="h-full bg-indigo-600 transition-all duration-1000" style={{ width: `${(timeLeft/totalTimeLimit)*100}%` }}></div>
                    </div>
                    <header className="bg-white p-4 border-b flex justify-between items-center px-6">
                        <div className="text-xl font-black tabular-nums text-slate-700">{formatTimeLabel(timeLeft)}</div>
                        <div className="text-center">
                            <div className="text-xs font-black text-slate-400 uppercase">Score</div>
                            <div className="text-xl font-black text-indigo-600">{score}</div>
                        </div>
                    </header>

                    <main className="flex-1 p-6 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-5 gap-4 max-w-5xl mx-auto w-full">
                        {cards.map((card, i) => {
                            const show = flipped.includes(i) || matched.includes(card.id);
                            return (
                                <div key={card.uid} onClick={() => handleCardClick(i)} className="aspect-[4/3] perspective-1000 cursor-pointer">
                                    <div className={`card-inner ${show ? 'flipped' : ''}`}>
                                        <div className="card-face bg-white border-2 border-slate-100 text-slate-200 font-black text-2xl">?</div>
                                        <div className={`card-face card-back border-2 ${matched.includes(card.id) ? 'bg-emerald-500 border-emerald-400 text-white' : 'bg-white border-indigo-500 text-indigo-600'}`}>
                                            <span className={`font-bold ${card.isAr ? 'arabic text-lg' : 'text-xs sm:text-sm'}`}>{card.text}</span>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </main>

                    {isGameOver && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-6">
                            <div className="bg-white rounded-[2rem] p-10 text-center max-w-sm w-full shadow-2xl relative">
                                {syncing && <div className="absolute top-4 right-4 flex items-center gap-2"><div className="spinner !border-indigo-600 !border-t-transparent"></div><span className="text-[8px] font-bold text-indigo-600">SYNCING</span></div>}
                                <h2 className="text-3xl font-black italic uppercase mb-2">Result</h2>
                                <div className="text-5xl font-black text-indigo-600 my-4">{score}</div>
                                <div className="text-sm font-bold text-slate-400 mb-8 uppercase tracking-widest">Points Collected</div>
                                <button onClick={startGame} className="w-full py-4 bg-indigo-600 text-white rounded-xl font-black mb-2">PLAY AGAIN</button>
                                <button onClick={() => setUser(null)} className="w-full py-4 bg-slate-100 text-slate-400 rounded-xl font-black">EXIT</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
